section Prepare Program & Domain
stop at examples.tests.MyClass:7
run examples/tests/LocalVariablesTest.java

section Build Knowledge Base
buildkb --limit-sdk --deep=examples
checkkb --is-consistent

section Are local variables correctly declared?

assert triples <<EOF
    prog:examples.tests.MyClass_basic java:declaresVariable prog:examples.tests.MyClass_basic_localVariable .

    prog:examples.tests.MyClass_basic_localVariable rdfs:range xsd:int ;
                                              rdfs:domain java:StackFrame .
EOF

section Are values present?

assert sparql-success <<EOF
    SELECT ?frame
    WHERE {
        ?frame a java:StackFrame ;
               prog:examples.tests.MyClass_basic_localVariable "42"^^xsd:int .
    }
EOF

stop at examples.tests.MyClass:17
cont
buildkb --limit-sdk

section Are local variables with same name recognized?

assert triples <<EOF
    prog:examples.tests.MyClass_scopes java:declaresVariable prog:examples.tests.MyClass_scopes_localVariable_0 ;
                                 java:declaresVariable prog:examples.tests.MyClass_scopes_localVariable_1 .
EOF

assert sparql-success <<EOF
    SELECT ?frame
    WHERE {
        ?frame a java:StackFrame ;
               prog:examples.tests.MyClass_scopes_localVariable_1 "1337"^^xsd:int .
    }
EOF

section Are variable source code locations available?

assert triples <<EOF
    prog:examples.tests.MyClass_scopes_localVariable_0 java:isAtLine "12"^^xsd:int .
    prog:examples.tests.MyClass_scopes_localVariable_1 java:isAtLine "16"^^xsd:int .
EOF

stop at examples.tests.MyClass:30
cont
buildkb --limit-sdk
dumpkb datatest.ttl

section Are variables removed by compile-time optimizations ignored?

assert triples <<EOF
    prog:examples.tests.MyClass_removedVar java:declaresVariable prog:examples.tests.MyClass_removedVar_localVariable .

    prog:examples.tests.MyClass_removedVar_localVariable java:isAtLine "28"^^xsd:int .
EOF

assert sparql-success <<EOF
    SELECT ?frame
    WHERE {
        ?frame a java:StackFrame ;
               prog:examples.tests.MyClass_removedVar_localVariable "12"^^xsd:int .
    }
EOF

cont