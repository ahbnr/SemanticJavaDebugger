section "Prepare Program & Domain"
stop at examples.tests.LVTMyClass:7
run examples/tests/LocalVariablesTest.java

section "Build Knowledge Base"
buildkb
checkkb --is-consistent

section "Are local variables correctly declared?"

assert triples '<<EOF
    prog:examples.tests.LVTMyClass.void_basic%28%29 java:declaresVariable prog:examples.tests.LVTMyClass.void_basic%28%29.localVariable .

    prog:examples.tests.LVTMyClass.void_basic%28%29.localVariable rdfs:range xsd:int ;
                                                               rdfs:domain java:StackFrame .
'EOF

section "Are values present?"

assert sparql success '<<EOF
    SELECT ?frame
    WHERE {
        ?frame a java:StackFrame ;
               prog:examples.tests.LVTMyClass.void_basic%28%29.localVariable "42"^^xsd:int .
    }
'EOF

stop at examples.tests.LVTMyClass:17
cont
buildkb

section "Are local variables with same name recognized?"

assert triples '<<EOF
    prog:examples.tests.LVTMyClass.void_scopes%28%29 java:declaresVariable prog:examples.tests.LVTMyClass.void_scopes%28%29.localVariable_0 ;
                                                  java:declaresVariable prog:examples.tests.LVTMyClass.void_scopes%28%29.localVariable_1 .
'EOF

assert sparql success '<<EOF
    SELECT ?frame
    WHERE {
        ?frame a java:StackFrame ;
               prog:examples.tests.LVTMyClass.void_scopes%28%29.localVariable_1 "1337"^^xsd:int .
    }
'EOF

section "Are variable source code locations available?"

assert triples '<<EOF
    prog:examples.tests.LVTMyClass.void_scopes%28%29.localVariable_0 java:isAtLine "12"^^xsd:int .
    prog:examples.tests.LVTMyClass.void_scopes%28%29.localVariable_1 java:isAtLine "16"^^xsd:int .
'EOF

stop at examples.tests.LVTMyClass:30
cont
buildkb

section "Are variables removed by compile-time optimizations ignored?"

assert triples '<<EOF
    prog:examples.tests.LVTMyClass.void_removedVar%28%29 java:declaresVariable prog:examples.tests.LVTMyClass.void_removedVar%28%29.localVariable .

    prog:examples.tests.LVTMyClass.void_removedVar%28%29.localVariable java:isAtLine "28"^^xsd:int .
'EOF

assert sparql success '<<EOF
    SELECT ?frame
    WHERE {
        ?frame a java:StackFrame ;
               prog:examples.tests.LVTMyClass.void_removedVar%28%29.localVariable "12"^^xsd:int .
    }
'EOF

cont